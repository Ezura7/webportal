<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Forum Chat Portal</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body { background: #f5f7fa; }
    .tab-section { display: none; }
    .tab-active { display: block; }
    .nav-link.active { background: #e9ecef; }
    .hapus-btn { cursor:pointer; color:#dc3545; }
    #registerModal {
      position:fixed; top:0; left:0; width:100vw; height:100vh; background:#0008; z-index:2000; display:none;
      align-items:center; justify-content:center;
    }
    #registerModal .modal-content {
      max-width:350px; margin:auto; padding:2rem; background:#fff; border-radius:0.5rem; box-shadow:0 4px 16px #3334;
    }
    #fotoPreview { width: 80px; height: 80px; object-fit: cover; border-radius: 50%; }
    .container { max-width: 900px; margin-top: 30px; }
    #loginPage { max-width: 400px; margin: 60px auto; }
    #calendar { max-width: 600px; margin: 0 auto 2rem; }
    #pendingUsersList li { font-size: 1rem; }
    .d-none { display: none !important; }
  </style>
</head>
<body>
  <!-- Login page -->
  <div id="loginPage" class="card p-4" style="display:none;">
    <h3 class="mb-3">Login Forum Chat Portal</h3>
    <input type="text" id="username" class="form-control mb-2" placeholder="Username">
    <input type="password" id="password" class="form-control mb-3" placeholder="Password">
    <button class="btn btn-primary w-100" onclick="doLogin()">Login</button>
    <button class="btn btn-link w-100 mt-2" onclick="showRegisterModal()">Daftar Akun Baru</button>
  </div>

  <!-- Main app -->
  <div id="mainApp" class="container card p-4" style="display:none;">
    <nav class="mb-3">
      <button class="nav-link active" onclick="showTab('dashboard', event)">Dashboard</button>
      <button class="nav-link" onclick="showTab('forumchat', event)">Forum Chat</button>
      <button class="nav-link" onclick="showTab('matkul', event)">Mata Kuliah</button>
      <button class="nav-link" onclick="showTab('jadwal', event)">Jadwal</button>
      <button class="nav-link" onclick="showTab('nilai', event)">Nilai</button>
      <button class="nav-link" onclick="showTab('tugas', event)">Tugas</button>
      <button class="nav-link" onclick="showTab('kalender', event)">Kalender</button>
      <button class="nav-link" onclick="showTab('catatan', event)">Catatan</button>
      <button class="nav-link" onclick="showTab('profil', event)">Profil</button>
      <button id="verifTabBtn" class="nav-link" style="display:none;" onclick="showTab('verifakun', event)">Verif. Akun</button>
      <button class="nav-link float-end text-danger" onclick="logout()">Logout</button>
    </nav>

    <div id="dashboard" class="tab-section tab-active">
      <h4>Selamat Datang di Forum Chat Portal</h4>
      <textarea id="dashboardInput" class="form-control mb-2" rows="2" placeholder="Catatan singkat..."></textarea>
      <button class="btn btn-secondary btn-sm" onclick="simpanText('dashboardInput')">Simpan</button>
    </div>

    <div id="forumchat" class="tab-section">
      <h4>Forum Chat</h4>
      <div id="chatBox" class="border rounded p-2 mb-2" style="height:250px; overflow-y:auto; background:#fff;"></div>
      <textarea id="chatInput" class="form-control mb-2" rows="2" placeholder="Ketik pesan..."></textarea>
      <button class="btn btn-primary btn-sm" onclick="kirimPesanChat()">Kirim</button>
    </div>

    <div id="matkul" class="tab-section">
      <h4>Daftar Mata Kuliah</h4>
      <table id="tabel-matkul" class="table table-striped">
        <thead><tr><th>Nama Mata Kuliah</th><th>Dosen</th><th>Aksi</th></tr></thead>
        <tbody></tbody>
      </table>
      <button class="btn btn-success btn-sm" onclick="tambahBarisManual('tabel-matkul')">Tambah Baris</button>
      <button class="btn btn-secondary btn-sm" onclick="simpanTabel('tabel-matkul')">Simpan</button>
    </div>

    <div id="jadwal" class="tab-section">
      <h4>Jadwal Kuliah</h4>
      <table id="tabel-jadwal" class="table table-striped">
        <thead><tr><th>Hari</th><th>Jam</th><th>Matkul</th><th>Kelas</th><th>Aksi</th></tr></thead>
        <tbody></tbody>
      </table>
      <button class="btn btn-success btn-sm" onclick="tambahBarisManual('tabel-jadwal')">Tambah Baris</button>
      <button class="btn btn-secondary btn-sm" onclick="simpanTabel('tabel-jadwal')">Simpan</button>
    </div>

    <div id="nilai" class="tab-section">
      <h4>Nilai</h4>
      <table id="tabel-nilai" class="table table-striped">
        <thead><tr><th>Matkul</th><th>Nilai</th><th>Aksi</th></tr></thead>
        <tbody></tbody>
      </table>
      <button class="btn btn-success btn-sm" onclick="tambahBarisManual('tabel-nilai')">Tambah Baris</button>
      <button class="btn btn-secondary btn-sm" onclick="simpanTabel('tabel-nilai')">Simpan</button>
    </div>

    <div id="tugas" class="tab-section">
      <h4>Daftar Tugas</h4>
      <table id="tabel-tugas" class="table table-striped">
        <thead><tr><th>Judul</th><th>Tenggat</th><th>Status</th><th>Aksi</th></tr></thead>
        <tbody></tbody>
      </table>
      <button class="btn btn-success btn-sm" onclick="tambahBarisManualTugas()">Tambah Baris</button>
      <button class="btn btn-secondary btn-sm" onclick="simpanTabelTugas()">Simpan</button>
    </div>

    <div id="kalender" class="tab-section">
      <h4>Kalender Kegiatan</h4>
      <div id="calendar"></div>
    </div>

    <div id="catatan" class="tab-section">
      <h4>Catatan Pribadi</h4>
      <ul id="listCatatan" class="list-group mb-2"></ul>
      <textarea id="catatanInput" class="form-control mb-2" rows="2" placeholder="Tulis catatan..."></textarea>
      <button class="btn btn-primary btn-sm" onclick="simpanCatatan()">Simpan Catatan</button>
    </div>

    <div id="profil" class="tab-section">
      <h4>Profil</h4>
      <img id="fotoPreview" src="https://ui-avatars.com/api/?name=User" class="mb-2">
      <input type="file" id="fotoInput" accept="image/*" onchange="uploadFoto()" class="form-control d-none">
      <button id="editFotoBtn" class="btn btn-secondary btn-sm mb-2" onclick="editFoto()">Ubah Foto</button>
      <table id="profilTable" class="table">
        <tr><td>Nama</td><td contenteditable="true"></td></tr>
        <tr><td>Email</td><td contenteditable="true"></td></tr>
        <tr><td>No. HP</td><td contenteditable="true"></td></tr>
        <tr><td>Alamat</td><td contenteditable="true"></td></tr>
      </table>
      <button class="btn btn-secondary btn-sm" onclick="simpanProfil()">Simpan Profil</button>
    </div>

    <div id="verifakun" class="tab-section" style="display:none;">
      <h4>Verifikasi Akun Pending</h4>
      <ul id="pendingUsersList" class="list-group"></ul>
    </div>
  </div>

  <!-- Modal Daftar -->
  <!-- Perbaikan: HAPUS class="d-flex" agar modal tidak auto-tampil -->
  <div id="registerModal" style="display:none;">
    <div class="modal-content">
      <h5 class="mb-3">Daftar Akun Baru</h5>
      <input type="text" id="regUsername" class="form-control mb-2" placeholder="Username">
      <input type="password" id="regPassword" class="form-control mb-2" placeholder="Password">
      <input type="text" id="regNama" class="form-control mb-3" placeholder="Nama Lengkap">
      <button class="btn btn-primary w-100 mb-2" onclick="registerAccount()">Daftar</button>
      <button class="btn btn-link w-100" onclick="hideRegisterModal()">Batal</button>
    </div>
  </div>

  <!-- Firebase & JS -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>
  <script>
    // Konfigurasi Firebase dari saya
    const firebaseConfig = {
      apiKey: "AIzaSyAeC2wlPafry-qaaPF0xvjOtoT7UhYarGg",
      authDomain: "forumchatportal.firebaseapp.com",
      databaseURL: "https://forumchatportal-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "forumchatportal",
      storageBucket: "forumchatportal.appspot.com",
      messagingSenderId: "827734259506",
      appId: "1:827734259506:web:5e8a59ff4cc28f32a3892b",
      measurementId: "G-V7SR8JG4TW"
    };
    firebase.initializeApp(firebaseConfig);
    window.db = firebase.database();
  </script>
  <script src="app.js"></script>
</body>
</html>
